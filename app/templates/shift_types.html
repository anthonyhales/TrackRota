{% extends "layout.html" %}
{% block content %}

<div class="d-flex align-items-center justify-content-between mb-3">
  <h1 class="h3 text-gray-800 mb-0">Shift Types</h1>

  <!-- Rota selector -->
  <form method="get">
    <select name="rota_id"
            class="form-control form-control-sm"
            onchange="this.form.submit()">
      {% for r in rotas %}
        <option value="{{ r.id }}"
                {% if r.id == current_rota.id %}selected{% endif %}>
          {{ r.name }}
        </option>
      {% endfor %}
    </select>
  </form>
</div>

<div class="row">
  <!-- ADD -->
  <div class="col-lg-5 mb-4">
    <div class="card shadow">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
          Add shift type ({{ current_rota.name }})
        </h6>
      </div>
      <div class="card-body">
        <form method="post" action="/shift-types/new">

          <!-- IMPORTANT -->
          <input type="hidden" name="rota_id" value="{{ current_rota.id }}">

          <div class="form-group">
            <label>Name</label>
            <input class="form-control" name="name" required>
          </div>

          <div class="form-group">
            <label>Description</label>
            <input class="form-control" name="description">
          </div>

          <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="activeNew" name="active" checked>
            <label class="form-check-label" for="activeNew">Active</label>
          </div>

          <button class="btn btn-primary" type="submit">Add</button>
        </form>
      </div>
    </div>
  </div>

  <!-- EXISTING -->
  <div class="col-lg-7 mb-4">
    <div class="card shadow">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
          Existing ({{ current_rota.name }})
        </h6>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm table-bordered">
            <thead>
              <tr>
                <th>Name</th>
                <th>Description</th>
                <th class="text-center">Active</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for st in items %}
              <tr>
                <form method="post" action="/shift-types/{{ st.id }}">

                  <!-- IMPORTANT -->
                  <input type="hidden" name="rota_id" value="{{ current_rota.id }}">

                  <td>
                    <input class="form-control form-control-sm"
                           name="name"
                           value="{{ st.name }}">
                  </td>

                  <td>
                    <input class="form-control form-control-sm"
                           name="description"
                           value="{{ st.description or '' }}">
                  </td>

                  <td class="text-center">
                    <input type="checkbox"
                           name="active"
                           {% if st.active %}checked{% endif %}>
                  </td>

                  <td class="text-center">
                    <button class="btn btn-sm btn-outline-primary" type="submit">
                      Save
                    </button>
                    {% if user.role == "Admin" %}
                    <form method="post"
                      action="/shift-types/{{ st.id }}/delete"
                      style="display:inline"
                      onsubmit="return confirm('Delete this shift type? This cannot be undone.');">
                    <button class="btn btn-sm btn-outline-danger">
                      Delete
                    </button>
                    </form>
                  {% endif %}
                  </td>
                </form>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
